!function(t){var e,i,n=[],a=[],l=1,s=100,d=function(){this.$img=document.createElement("img"),this.$img.style.marginTop=e+"px",this.img=a.shift()||new Image,this.img.onload=this.handleLoad.bind(this)},c=function(){return(document.documentElement.scrollTop||document.body.scrollTop)+(document.documentElement.clientHeight||document.body.clientHeight)};d.prototype.setSrc=function(t,e){t.appendChild(this.$img),this.$img.src="images/loading.gif",this.img.src=e},d.prototype.handleLoad=function(){this.$img.src=this.img.src,this.img.src="",a.push(this.img),this.img=null},t.waterfall={album:document.getElementById("album-waterfall"),init:function(){var t=this.album.dataset.width||this.album.clientWidth;i=(this.album.dataset.column||4)-0,e=this.album.dataset.gap||16,this.album.style.width=t+"px";for(var a=0;a<i;a++){var l=this.album.appendChild(document.createElement("div"));l.style.width=100/i+"%",l.style.paddingLeft=e/2+"px",l.style.paddingRight=e/2+"px",n.push(l)}this.load()},load:function(){do(new d).setSrc(n[0],"images/pictures/pic"+l++ +".jpg"),n.sort(function(t,e){return t.clientHeight-e.clientHeight});while(c()>n[0].offsetHeight+n[0].offsetTop)},add:function(){l<=s&&c()>n[0].offsetHeight+n[0].offsetTop&&((new d).setSrc(n[0],"images/pictures/pic"+l++ +".jpg"),n.sort(function(t,e){return t.clientHeight-e.clientHeight}))},adjust:function(t,a){if("column"==t){var l;a?(i++,l=this.album.appendChild(document.createElement("div")),l.dataset.column=i-1,n.push(l),n.forEach(function(t){t.style.width=100/i+"%",t.style.paddingLeft=e/2+"px",t.style.paddingRight=e/2+"px"}),this.load()):i>2&&(i--,l=this.album.removeChild(this.album.firstElementChild),n.splice(n.indexOf(l),1),n.forEach(function(t){t.style.width=100/i+"%"}))}else"gutter"==t&&(a?(e+=4,n.forEach(function(t){t.style.paddingLeft=e/2+"px",t.style.paddingRight=e/2+"px",Array.prototype.forEach.call(t.children,function(t){t.style.marginTop=e+"px"})})):e>4&&(e-=4,n.forEach(function(t){t.style.paddingLeft=e/2+"px",t.style.paddingRight=e/2+"px",Array.prototype.forEach.call(t.children,function(t){t.style.marginTop=e+"px"})})))}}}(this),function(){var t=document.getElementById("choises"),e=document.getElementById("display");t.addEventListener("click",function(t){switch(t.target.id){case"add-column":waterfall.adjust("column",!0);break;case"reduce-column":waterfall.adjust("column",!1);break;case"add-gutter":waterfall.adjust("gutter",!0);break;case"reduce-gutter":waterfall.adjust("gutter",!1)}},!1),waterfall.album.addEventListener("click",function(t){if("IMG"==t.target.nodeName){var i=e.firstElementChild;i.setAttribute("src",t.target.getAttribute("src")),e.className+=" in"}},!1),e.addEventListener("click",function(t){"IMG"!=t.target.nodeName&&(e.className="fade")}),window.addEventListener("scroll",function(){waterfall.add()},!1),waterfall.init()}();