var drawLetter=function(){var n={},e=function(){return" #"+Math.random().toString(16).slice(2,8)};return n.a="MOV BOT\nTAR RIG 4\nTUN BAC\nBUILD\nBRU"+e()+"\nTAR BOT\nTAR LEF\nBUILD\nBRU"+e()+"\nTAR RIG 2\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR LEF 2\nBUILD\nBRU"+e()+"\nTAR BOT\nTAR LEF\nBUILD\nBRU"+e()+"\nTAR RIG 4\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR LEF 4\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR LEF 6\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR RIG 6\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR LEF 6\nBUILD\nBRU"+e(),n.b="TAR BOT\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR LEF 4\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR RIG 4\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR LEF 4\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR LEF 5\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR RIG 5\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR LEF 5\nBUILD\nBRU"+e()+"\nTAR LEF\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e(),n.c="TAR BOT\nTAR RIG 4\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR LEF 4\nBUILD\nBRU"+e()+"\nTAR LEF\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR BOT\nBUILD\nBRU"+e()+"\nTAR BOT\nTAR RIG\nBUILD\nBRU"+e()+"\nTAR RIG 4\nBUILD\nBRU"+e()+"\nTAR BOT\nTAR LEF\nBUILD\nBRU"+e()+"\nTAR LEF\nBUILD\nBRU"+e()+"\nTAR LEF\nBUILD\nBRU"+e(),n.hi="MOV RIG\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nGO 2\nTUN LEF\nGO 3\nBUILD\nBRU #0000FF\nTAR RIG\nBUILD\nBRU #0000FF\nMOV RIG 2\nTAR TOP 4\nTUN BAC\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nTAR BOT\nBUILD\nBRU #FF0000\nMOV TOP 5\nTAR RIG\nBUILD\nBRU #99FFCC\nTAR BOT 2\nBUILD\nBRU #FF99CC\nTAR BOT\nBUILD\nBRU #FF99CC\nTAR BOT\nBUILD\nBRU #FF99CC\nTAR BOT\nBUILD\nBRU #FF99CC\nTAR BOT\nBUILD\nBRU #FF99CC\nTAR LEF 7\nGO 8",function(e){return n[e.toLowerCase()]}}();!function(){function n(n){return~~(n+.5)}function e(n,e){var a=e-n;return~~(Math.random()*a+n)}function a(n){var e={};for(var a in n)e[a]=n[a];return e}function o(n){return n.replace(/^\s+|\s+$/g,"")}function t(n,e,a,o,t,B){return(n-t)*(a-t)<=0&&(e-B)*(o-B)<=0}var B=30,R=30,c=45,r=document.getElementById("grid-space"),l=r.getContext("2d");l.font="20px sans-serif",l.textAlign="center",l.textBaseline="middle";var U,s,d,T;for(U=0;U<10;U++)s=B+1+(c+1)/2*(2*U+1),d=R/2,l.fillText(U+1,s,d),T=s,s=d,d=T,l.fillText(U+1,s,d);for(l.lineWidth=2,l.strokeStyle="black",l.strokeRect(B+1,R+1,10*(c+1)+1,10*(c+1)+1),l.beginPath(),l.lineWidth=1,l.strokeStyle="#cdcdcd",U=1;U<10;U++)s=B+1.5+(c+1)*U,d=R+2,l.moveTo(s,d),l.lineTo(s,d+10*(c+1)-1),T=s,s=d,d=T,l.moveTo(s,d),l.lineTo(s+10*(c+1)-1,d);l.stroke();var i=function(e){e.squareCanvas.style.left=n(B+2+(e.coodX-1)*(c+1))+"px",e.squareCanvas.style.top=n(R+2+(e.coodY-1)*(c+1))+"px",e.squareCanvas.style.transform="rotate("+n(e.angle)+"deg)"},I=function(n,e,a){a="undefined"==typeof a?"#ccc":a,l.save(),l.translate(B+2+(n-1)*(c+1),B+2+(e-1)*(c+1)),l.fillStyle=a,l.fillRect(0,0,c,c),l.restore()},u=function(){var n=1,e=1,a=0,o=document.createElement("canvas"),t=document.getElementById("map");return t.appendChild(o),o.width=c,o.height=c,squareCtx=o.getContext("2d"),squareCtx.fillStyle="red",squareCtx.fillRect(0,0,c,c),squareCtx.fillStyle="blue",squareCtx.fillRect(0,0,c,10),t.style.position="relative",o.style.position="absolute",{squareCanvas:o,coodX:n,coodY:e,angle:a}}(),L=function(){var n=500,o=[],B={GO:function(n){switch(n="undefined"==typeof n?1:n-0,u.angle){case 0:u.coodY-=n;break;case 90:u.coodX+=n;break;case 180:u.coodY+=n;break;case 270:u.coodX-=n;break;case-90:u.coodX-=n;break;case-180:u.coodY+=n;break;case-270:u.coodX+=n}},TUN:function(n){switch(n){case"LEF":u.angle-=90;break;case"RIG":u.angle+=90;break;case"BAC":u.angle+=180}},TAR:function(n,e){switch(e="undefined"==typeof e?1:e-0,n){case"LEF":u.coodX-=e;break;case"TOP":u.coodY-=e;break;case"RIG":u.coodX+=e;break;case"BOT":u.coodY+=e}},MOV:function(n,e,a){switch(e="undefined"==typeof e?1:e-0,a="undefined"==typeof e?1:e-0,n){case"LEF":switch(u.coodX-=e,u.angle){case 0:u.angle-=90;break;case 90:u.angle-=180;break;case 180:u.angle+=90;break;case-180:u.angle+=90;break;case-270:u.angle-=180}break;case"TOP":switch(u.coodY-=e,u.angle){case 90:u.angle-=90;break;case 180:u.angle+=180;break;case 270:u.angle+=90;break;case-90:u.angle+=90;break;case-180:u.angle+=180;break;case-270:u.angle-=90}break;case"RIG":switch(u.coodX+=e,u.angle){case 0:u.angle+=90;break;case 180:u.angle-=90;break;case 270:u.angle+=180;break;case-90:u.angle+=180;break;case-180:u.angle-=90}break;case"BOT":switch(u.coodY+=e,u.angle){case 0:u.angle+=180;break;case 90:u.angle+=90;break;case 270:u.angle-=90;break;case-90:u.angle-=90;break;case-270:u.angle+=90}}},BUILD:function(){var n=u.coodX,e=u.coodY;switch(u.angle){case 0:e--;break;case 90:n++;break;case 180:e++;break;case 270:n--;break;case-90:n--;break;case-180:e++;break;case-270:n--}var a=!0;if(n>10||n<1||e>10||e<1)console.log("错误：无法修墙");else{for(var t=0;t<o.length;t++)if(o[t][0]==n&&o[t][1]==e){console.log("错误：无法修墙"),a=!1;break}a&&(I(n,e),o.push([n,e]))}},BRU:function(n){var e=u.coodX,a=u.coodY;switch(u.angle){case 0:a--;break;case 90:e++;break;case 180:a++;break;case 270:e--;break;case-90:e--;break;case-180:a++;break;case-270:e--}for(var t=!1,B=0;B<o.length;B++)if(o[B][0]==e&&o[B][1]==a){t=!0;break}t?I(e,a,n):console.log("错误：无法粉刷")},refresh:function(){u.coodX=1,u.coodY=1,u.angle=0,i(u),o.forEach(function(n){I(n[0],n[1],"white")}),o.length=0},random:function(){for(var n=e(1,10),a=e(1,10),t=!0,B=0;B<o.length;B++)if(o[B][0]==n&&o[B][1]==a){console.log("错误：无法修墙"),t=!1;break}t&&(I(n,a),o.push([n,a]))}},R=function(e,R){if("refresh"==e)return void B.refresh();if("random"==e)return void B.random();"slow"==R?n=1e3:"middle"==R?n=500:"fast"==R?n=200:"top"==R&&(n=50);var c=a(u),r=!1,l=0,U=!1,s=function(){var a=e[l++]||[""];"BUILD"==a[0]||"BRU"==a[0]?setTimeout(function(){d(a)},n):d(a)},d=function(a){B[a[0]].apply(B,a.slice(1)),u.coodX>10?u.coodX=10:u.coodX<1&&(u.coodX=1),u.coodY>10?u.coodY=10:u.coodY<1&&(u.coodY=1);for(var R=0;R<o.length;R++)if(t(c.coodX,c.coodY,u.coodX,u.coodY,o[R][0],o[R][1])){U=!0,t(c.coodX,c.coodY,o[R][0],o[R][1],o[R][0]+1,o[R][1])?u.coodX=o[R][0]+1:t(c.coodX,c.coodY,o[R][0],o[R][1],o[R][0]-1,o[R][1])?u.coodX=o[R][0]-1:t(c.coodX,c.coodY,o[R][0],o[R][1],o[R][0],o[R][1]+1)?u.coodY=o[R][1]+1:u.coodY=o[R][1]-1;break}var d=u.coodX-c.coodX,T=u.coodY-c.coodY,I=u.angle-c.angle,L=Date.now();requestAnimationFrame(function A(){var a=Date.now();c.coodX+=(a-L)*d/n,c.coodY+=(a-L)*T/n,c.angle+=(a-L)*I/n,d>0&&c.coodX>u.coodX||d<0&&c.coodX<u.coodX?(c.coodX=u.coodX,r=!1):0!==d&&c.coodX!==u.coodX&&(r=!0),T>0&&c.coodY>u.coodY||T<0&&c.coodY<u.coodY?(c.coodY=u.coodY,r=!1):0!==T&&c.coodY!==u.coodY&&(r=!0),I>0&&c.angle>u.angle||I<0&&c.angle<u.angle?(c.angle=u.angle,r=!1):0!==I&&c.angle!==u.angle&&(r=!0),r?(i(c),L=a,requestAnimationFrame(A)):(i(u),Math.abs(u.angle)>=360&&(u.angle=u.angle>0?u.angle-360:u.angle+360,c.angle=u.angle),!U&&l<e.length?setTimeout(function(){s()},10):U&&alert("有墙，无法通过！"))})};s()};return{changeState:R}}();i(u);var A=document.getElementById("command-zone"),f=A.firstElementChild,g=A.lastElementChild,D=document.getElementById("exec"),F=document.getElementById("refresh"),v=document.getElementById("letter"),m=document.getElementById("speed"),O=document.getElementById("randomWall"),h=function(){var n=[],e=0;return{add:function(){var a=n.pop();a?(a.innerHTML=++e,g.appendChild(a)):g.appendChild(document.createElement("span")).innerHTML=++e},remove:function(){var a=g.lastElementChild;a.className="",n.push(g.removeChild(a)),e--}}}(),k=function(){var n=f.value,e=n.match(/\n/g);e=e?e.length+1:1;for(var a=0,o=g.childElementCount;a<o;a++)h.remove();for(var t=0;t<e;t++)h.add()};f.addEventListener("focus",function(){this.value||h.add()},!1),f.addEventListener("blur",function(){this.value||h.remove()},!1),f.addEventListener("scroll",function(){g.style.top=-f.scrollTop+"px"},!1),f.addEventListener("input",function(){k()},!1),D.addEventListener("click",function(){var n=(f.value.split("\n"),b(f.value));n.res?L.changeState(n.value,m.value):(console.log("wrong",n.value),n.value.forEach(function(n){g.childElementCount>0&&(g.childNodes[n].className="error")}))},!1),F.addEventListener("click",function(){f.value="",L.changeState("refresh")},!1),v.addEventListener("change",function(){this.value&&(drawLetter(this.value),f.value=drawLetter(this.value),k())},!1),O.addEventListener("click",function(){L.changeState("random")},!1);var b=function(){var n=[];return n[0]=/^GO(\s+\d{1,2})?$/,n[1]=/^TUN\s+(LEF|RIG|BAC)/,n[2]=/^TAR\s+(LEF|RIG|TOP|BOT)(\s+\d{1,2})?$/,n[3]=/^MOV\s+(LEF|RIG|TOP|BOT)(\s+\d{1,2})?$/,n[4]=/^BUILD$/,n[5]=/^BRU\s+#[0-9A-Fa-f]{6}$/,n[6]=/^MOV\s+TO\s+\d{1,2}\s+\d{1,2}$/,function(e){for(var a,t=[],B=[],R=e.split("\n"),c=!0,r=function(n){return n.test(a)},l=0;l<R.length;l++)a=o(R[l]),c=n.some(r),c?B.length||t.push(a.split(/\s+/)):B.push(l);return B.length?{res:!1,value:B}:{res:!0,value:t}}}();f.value=drawLetter("hi"),k(),v.value="选择一个字母"}(),function(){var n=16,e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,n)};window.requestAnimationFrame=e}();