!function(){var t=[];t[0]=[[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,0,1,1,1,1,1,0,1,1],[1,1,0,1,1,1,1,1,0,1,1],[1,1,0,1,1,1,1,1,0,1,1],[1,1,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1]],t[1]=[[1,1,1,1,1,1,1,0,1,1,1],[1,1,1,1,1,1,1,0,1,1,1],[1,1,1,0,0,0,0,0,1,1,1],[1,1,0,1,1,1,1,1,1,1,1],[1,0,1,1,1,1,1,1,1,1,1],[1,0,1,1,0,0,0,0,0,1,0],[1,0,1,1,1,1,1,1,0,1,1],[1,1,0,1,1,1,1,1,0,1,1],[1,1,0,0,0,0,0,1,0,1,1],[1,1,1,1,1,1,0,1,0,1,1],[1,1,1,1,1,0,1,1,0,1,1],[1,1,1,1,0,1,1,1,0,1,1],[1,1,1,0,1,1,1,1,0,1,1],[1,1,1,1,1,1,1,1,0,1,1],[1,1,0,0,0,0,0,0,0,1,1],[1,1,0,1,1,1,1,1,1,1,1],[1,1,0,1,1,1,1,1,1,1,1],[1,1,0,1,1,1,1,1,1,1,1]],window.data=t}(),function(){var t=32,n=18,i=11,a=function(){var t,a,e,o,r=[],s=0,h=30;for(e=0;e<n;e++)for(r[e]=[],o=0;o<i;o++)r[e][o]=1;for(;s++<h;){do t=~~(Math.random()*n),a=~~(Math.random()*i);while(t==flag.x&&a==flag.y||t==mario.x&&a==mario.y);r[t][a]=0}return r},e={row:n,column:i,unit:t,data:data.shift(),update:function(){this.data=data.shift()||a()}};window.map=e}(),function(){var t,n=0,i=(map.column-1)/2,a=map.row-1,e=(map.column-1)/2,o=1,r=.1,s=0,h=0,u=!0,m=!0,f=function(){p.x=n,p.y=i,path["new"]=!1,u=!0,m=!0},p={x:n,y:i,speed:o,move:function(n){if(path["new"]){if(u&&m){if(t=path.value.shift(),!t)return void(path["new"]=!1);s=t.x>p.x?1:-1,h=t.y>p.y?1:-1}p.x+=n*this.speed/map.unit*s,p.y+=n*this.speed/map.unit*h,s>0&&p.x<t.x||s<0&&p.x>t.x?u=!1:(p.x=t.x,u=!0),h>0&&p.y<t.y||h<0&&p.y>t.y?m=!1:(p.y=t.y,m=!0),p.x==c.x&&p.y==c.y&&(f(),map.update(),v=monstersPosi.shift(),d.forEach(function(t,n){t.update(n)}))}}},c={x:a,y:e},d=[],w=[],y=[];monstersPosi=[[[5,3,1.5],[10,2,2.5],[10,8,2.5]],[[11,3,1.5],[4,6,1.5],[2,8,1.5]]];var l=function(t,n,i){this.x=t,this.y=n,this.area=i*i,this.interval=500};l.prototype.detect=function(t){this.interval+=t,this.interval>500&&(this.interval=500);var n=(this.x-p.x)*(this.x-p.x)+(this.y-p.y)*(this.y-p.y);this.area>n&&500==this.interval&&(this.fire(n),this.interval=0)},l.prototype.update=function(t){var n,i,a;if(v)n=v[t][0],i=v[t][1],a=v[t][2];else do n=~~(Math.random()*(map.row-4)+2),i=~~(Math.random()*map.column),a=~~(3*Math.random()+1)+.5;while(0===map.data[n][i]);this.x=n,this.y=i,this.setArea(a)},l.prototype.fire=function(t){var n=(p.x-this.x)/Math.sqrt(t),i=(p.y-this.y)/Math.sqrt(t),a=y.shift();a?(a.x=this.x,a.y=this.y,a.radio=[n,i]):a=new x(this.x,this.y,[n,i]),w.push(a)},l.prototype.setArea=function(t){this.area=t*t};var x=function(t,n,i){this.x=t,this.y=n,this.radio=i};x.prototype.speed=r,x.prototype.move=function(t){this.x+=t*this.speed*this.radio[0]/map.unit,this.y+=t*this.speed*this.radio[1]/map.unit;var n=~~this.x,i=~~this.y;(n<0||n>=map.row||i<0||i>=map.column||0===map.data[n][i])&&y.concat(w.splice(w.indexOf(this),1)),(this.x-p.x)*(this.x-p.x)+(this.y-p.y)*(this.y-p.y)<.5&&(alert("GAME OVER"),y.concat(w.splice(w.indexOf(this),1)),f())};var v=monstersPosi.shift();d.push(new l(v[0][0],v[0][1],v[0][2])),d.push(new l(v[1][0],v[1][1],v[1][2])),d.push(new l(v[2][0],v[2][1],v[2][2])),window.mario=p,window.flag=c,window.monsters=d,window.fireballs=w}();var astar=function(t,n,i){function a(t,n){for(var i,a=[],o=!1,h=null;c.length>0;){if(h=c[0],h.x==n.x&&h.y==n.y){o=!0;break}for(var w=h.x-1,y=w+3;w<y;w++)for(var l=h.y-1,x=l+3;l<x;l++)w<0||w>=f||l<0||l>=p||w==h.x&&l==h.y||(i=w==h.x||l==h.y?u:m,e(w,l,h,n,i));d.push(c.shift()),c.sort(s)}return o&&r(a,h),a}function e(t,n,a,e,r){var s=new h(t,n,a);if(0===i[t][n])return void d.push(s);if(o(d,t,n)==-1){var u=o(c,t,n);u!=-1?a.g+r<c[u].g&&(c[u].parentNode=a,c[u].setG(r)):0!==i[t][a.y]&&0!==i[a.x][n]&&(s.setG(r),s.setH(e),c.push(s))}}function o(t,n,i){var a,e;for(a=0;a<t.length;a++)if(e=t[a],e.x==n&&e.y==i)return a;return-1}function r(t,n){null!==n.parentNode&&r(t,n.parentNode),t.push(n)}function s(t,n){return t.f-n.f}function h(t,n,i){this.x=t,this.y=n,this.parentNode=i,this.g=0,this.h=0,this.f=0,"function"!=typeof h.prototype.setG&&(h.prototype.setG=function(t){this.g=(this.parentNode||{g:0}).g+t,this.f=this.g+this.h},h.prototype.setH=function(t){this.h=Math.abs(this.x-t.x)*u+Math.abs(this.y-t.y)*u,this.f=this.g+this.h})}var u=10,m=14,f=window.map.row,p=window.map.column,c=[],d=[],w=[],y=t[0],l=t[1],x=n[0],v=n[1];if(y<0||y>=f||l<0||l>=p||x<0||x>=f||v<0||v>=p)return w;if(0===i[y][l]||0===i[x][v])return w;var g=new h(y,l,null),E=new h(x,v,null);return c.push(g),w=a(g,E)};!function(){var t={"new":!1,value:[]};document.addEventListener("click",function(n){if("game"==n.target.id){var i=~~(n.clientY/map.unit),a=~~(n.clientX/map.unit);t["new"]=!0;var e=[~~(mario.x+.5),~~(mario.y+.5)],o=[i,a];t.value=astar(e,o,map.data)}}),window.path=t}(),function(){var t=document.getElementById("game"),n=t.getContext("2d"),i=new Image,a=new Image,e=new Image,o=new Image,r=new Image,s=!1,h=!1,u=!1,m=!1,f=!1;i.onload=function(){s=!0},a.onload=function(){h=!0},e.onload=function(){u=!0},o.onload=function(){m=!0},r.onload=function(){f=!0},i.src="images/block.png",a.src="images/mario.png",e.src="images/flag.png",o.src="images/monster.png",r.src="images/fireball.gif";var p=function(){s&&h&&u&&m&&f&&(window.render=function(s){n.clearRect(0,0,t.width,t.height),s.forEach(function(t,a){t.forEach(function(t,e){s[a][e]||n.drawImage(i,e*map.unit,a*map.unit)})}),n.drawImage(a,mario.y*map.unit,mario.x*map.unit),n.drawImage(e,flag.y*map.unit,flag.x*map.unit),monsters.forEach(function(t){n.drawImage(o,t.y*map.unit,t.x*map.unit)}),fireballs.forEach(function(t){n.drawImage(r,t.y*map.unit,t.x*map.unit)})})};window.render=p}(),function(){!function(){var t=62.5,n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(n){setTimeout(n,t)};window.requestAnimationFrame=n}();var t,n,i,a=function(){t=Date.now(),i=t-n,mario.move(i),monsters.forEach(function(t){t.detect(i)}),fireballs.forEach(function(t){t&&t.move(i)}),render(map.data),n=t,requestAnimationFrame(a)};n=Date.now(),a()}();